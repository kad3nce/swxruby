  <div id="C00000019">
<div class='banner'>
  <span class="file-title-prefix">Class</span><br />SwxGateway<br/>
  In:
<a href="#" onclick="jsHref('files/lib/swxruby/swx_gateway_rb.html');">lib/swxruby/swx_gateway.rb</a>

Parent:&nbsp;
        <a href="#" onclick="jsHref('classes/Object.html');">
Object
         </a>
</div>
 <!-- banner header -->

  <div id="bodyContent" >
      <div id="content">




  <div class="sectiontitle">Methods</div>
  <ul>
  <li><a href="index.html?a=M000129&name=init_service_classes" >init_service_classes</a></li>
  <li><a href="index.html?a=M000130&name=nillify_nulls" >nillify_nulls</a></li>
  <li><a href="index.html?a=M000131&name=process" >process</a></li>
  </ul>





  <div class="sectiontitle">Attributes</div>
  <table border='0' cellpadding='5'>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>app_root</td>
    <td class='attr-desc'></td>
  </tr>
  <tr valign='top'>
    <td class='attr-rw'>
[RW]
    </td>
    <td class='attr-name'>swx_config</td>
    <td class='attr-desc'></td>
  </tr>
  </table>

<div class="sectiontitle">Public Class methods</div>
<div id="M000129" class="method">
  <div id="M000129_title" class="title">
    <b>init_service_classes</b>()
  </div>
  <div class="description">
  <p>
Eval all files in the services_path into the <a
href="index.html?a=C00000033&name=SwxServiceClasses">SwxServiceClasses</a>
namespace
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000129_source')" id="l_M000129_source">show source</a> ]</p>
  <div id="M000129_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/swxruby/swx_gateway.rb, line 14</span>
14:                 <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">init_service_classes</span>
15:                         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">app_root</span>, <span class="ruby-identifier">swx_config</span>[<span class="ruby-value str">'services_path'</span>], <span class="ruby-value str">'./**/*.rb'</span>))      <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span><span class="ruby-operator">|</span> 
16:                                 <span class="ruby-comment cmt"># Load service class into SwxServiceClasses namespace. </span>
17:                                 <span class="ruby-constant">SwxServiceClasses</span>.<span class="ruby-identifier">module_eval</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">filename</span>))
18:                         <span class="ruby-keyword kw">end</span>
19:                         <span class="ruby-keyword kw">true</span>
20:                 <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000130" class="method">
  <div id="M000130_title" class="title">
    <b>nillify_nulls</b>(args_array)
  </div>
  <div class="description">
  <p>
Convert strings containing &#8216;null&#8217; to nil. Null in Flash is
equivalent to nil in Ruby.
</p>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000130_source')" id="l_M000130_source">show source</a> ]</p>
  <div id="M000130_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/swxruby/swx_gateway.rb, line 23</span>
23:                 <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">nillify_nulls</span>(<span class="ruby-identifier">args_array</span>)
24:                         <span class="ruby-comment cmt"># Convert all strings containing 'null' to nil</span>
25:                         <span class="ruby-identifier">args_array</span>.<span class="ruby-identifier">collect!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arg</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'null'</span> <span class="ruby-keyword kw">then</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">arg</span> <span class="ruby-keyword kw">end</span> }
26:                         <span class="ruby-comment cmt"># Return nil if the args array contained only 'null' strings</span>
27:                         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args_array</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">then</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">else</span> <span class="ruby-identifier">args_array</span> <span class="ruby-keyword kw">end</span>
28:                 <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
<div id="M000131" class="method">
  <div id="M000131_title" class="title">
    <b>process</b>(params)
  </div>
  <div class="description">
  <p>
The entry point for SWX request processing. Takes a hash of <tt>params</tt>
and goes to work generating SWX bytecode.
</p>
<p>
Special note: Contrary to Ruby convention, keys in the <tt>params</tt> hash
are camelCase (instead of underscored). This is to maintain compatibility
with the SWX AS library which sends request parameters using camelCase
(ActionScript&#8217;s variable naming convention).
</p>
<h4>Params</h4>
<ul>
<li><tt>:args</tt> &#8212; JSON string of arguments (converted to a Ruby object
and passed to the specified method of the service class)

</li>
<li><tt>:debug</tt> &#8212; Boolean. If set to true, the generated SWX file
will attempt to establish a local connection the SWX Analyzer when opened
in Flash Player.

</li>
<li><tt>:method</tt> &#8212; specifies the method to be called on the service
class. May be either camelCased or underscored (camelCased will be
converted to underscored before being called on the service class)

</li>
<li><tt>:serviceClass</tt> &#8212; specifies the service class

</li>
<li><tt>:url</tt> &#8212; (optional) the url of the SWF file making this
request. Added to the generated SWX file to skirt cross-domain issues. If
not specified, the resulting SWX file allow access from any domain

</li>
</ul>
<h4>Examples</h4>
<pre>
  SwxGateway.process(:args =&gt; 'Hello World!', :debug =&gt; true, :method =&gt; 'echo_data', :serviceClass =&gt; 'Simple', :url =&gt; 'http://myfunkysite/swxconsumer.swf')
  # =&gt; A binary string of SWX bytecode containing the result of +Simple.new#echo_data('Hello World!')+; debugging enabled and allowing access from the specified url

  SwxGateway.process(:args =&gt; 'Hello World!', :debug =&gt; true, :method =&gt; 'echo_data', :serviceClass =&gt; 'Simple')
  # =&gt; Same as previous, except allows access from any url

  SwxGateway.process(:args =&gt; [1,2], :debug =&gt; false, :method =&gt; 'addNumbers', :serviceClass =&gt; 'Simple', :url =&gt; 'http://myfunkysite/swxconsumer.swf')
  # calls params[:method].underscore
  # =&gt; A binary string of SWX bytecode containing the result of +Simple.new#add_numbers(1, 2)+; no debugging and allowing access from the specified url
</pre>
  </div>
<div class="sourcecode">
  <p class="source-link">[ <a href="javascript:toggleSource('M000131_source')" id="l_M000131_source">show source</a> ]</p>
  <div id="M000131_source" class="dyn-source">
<pre>
    <span class="ruby-comment cmt"># File lib/swxruby/swx_gateway.rb, line 53</span>
53:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process</span>(<span class="ruby-identifier">params</span>)
54:                         <span class="ruby-comment cmt"># convert JSON arguments to a Ruby object</span>
55:                         <span class="ruby-identifier">args</span> = <span class="ruby-identifier">json_to_ruby</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:args</span>]
56:                         
57:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">nil?</span>
58:         <span class="ruby-comment cmt"># Ensure that none of the arguments contain 'undefined'</span>
59:                         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;The request contained undefined args.\n  serviceClass: #{params[:serviceClass]}\n  method: #{params[:method]}\n  args: #{args.join(', ')}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">argument</span><span class="ruby-operator">|</span> <span class="ruby-identifier">argument</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'undefined'</span> }
60:                                 <span class="ruby-comment cmt"># Convert 'null' strings in args array to nil</span>
61:                           <span class="ruby-identifier">args</span> = <span class="ruby-identifier">nillify_nulls</span>(<span class="ruby-identifier">args</span>)
62:                 <span class="ruby-keyword kw">end</span>
63:                         
64:                         <span class="ruby-comment cmt"># Fetch the class contsant for the specified service class</span>
65:                         <span class="ruby-identifier">validate_service_class_name</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:serviceClass</span>])
66:       <span class="ruby-identifier">service_class</span> = <span class="ruby-identifier">class_eval</span>(<span class="ruby-node">&quot;SwxServiceClasses::#{params[:serviceClass]}&quot;</span>)
67: 
68:                         <span class="ruby-comment cmt"># convert camelCased params[:method] to underscored (does nothing if params[:method] is already underscored)</span>
69:                         <span class="ruby-comment cmt"># This effectively bridges the gap between ActionScript and Ruby variable/method naming conventions.</span>
70:                         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:method</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:method</span>].<span class="ruby-identifier">underscore</span>
71: 
72:                         <span class="ruby-comment cmt"># Prevent nefarious use of methods that the service class inherited from Object</span>
73:                         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoMethodError</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">service_class</span>.<span class="ruby-identifier">public_instance_methods</span> <span class="ruby-operator">-</span> <span class="ruby-constant">Object</span>.<span class="ruby-identifier">public_instance_methods</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:method</span>])
74:                         
75:       <span class="ruby-comment cmt"># Instantiate the service class, call the specified method, and capture the response</span>
76:                         <span class="ruby-identifier">service_class_response</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">nil?</span>
77:                                 <span class="ruby-comment cmt"># No args were passed, so assume the service class' method doesn't take any arguments</span>
78:               <span class="ruby-identifier">service_class</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:method</span>])
79:                         <span class="ruby-keyword kw">else</span>
80:                                 <span class="ruby-comment cmt"># Call the service class' method and pass in the arguments (uses an * to pass an array as multiple arguments)</span>
81:               <span class="ruby-identifier">service_class</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:method</span>], <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
82:                         <span class="ruby-keyword kw">end</span>
83:         
84:       <span class="ruby-comment cmt"># assemble and return swx file </span>
85:       <span class="ruby-identifier">debug_param</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:debug</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">'true'</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">false</span>
86:                         <span class="ruby-constant">SwxAssembler</span>.<span class="ruby-identifier">write_swf</span>(<span class="ruby-identifier">service_class_response</span>, <span class="ruby-identifier">debug_param</span>, <span class="ruby-identifier">swx_config</span>[<span class="ruby-value str">'compression_level'</span>], <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:url</span>], <span class="ruby-identifier">swx_config</span>[<span class="ruby-value str">'allow_domain'</span>])
87:     <span class="ruby-keyword kw">end</span>
</pre>
  </div>
</div>
</div>
</div>

  </div>